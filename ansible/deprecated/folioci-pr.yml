---

## vars to pass in okapi_url, tenant, tenant_admin.username, tenant_admin.password,
# tenant_admin.perms_user_id

- hosts: localhost
  connection: local 
  gather_facts: yes
  vars:
    auth_required: true
    top_down_install: true
    num_users: 15
    pg_host: folio-snapshot-stable.indexdata.internal

  pre_tasks: 
    - name: include some global vars
      include_vars: 
        file: vars_pr.yml

    - name: include global ec2 vars
      include_vars: 
        dir: group_vars/ci

  roles:
    - role: folio-ansible/roles/create-tenant-admin
    - role: folio-ansible/roles/tenant-admin-permissions 
    - role: folio-ansible/roles/module-sample-data
      module_name: mod-inventory-storage
      repository: "https://github.com/folio-org/mod-inventory-storage"
      duplicate_key_error: 400
      files:
        - { load_endpoint: /classification-types, fileglob: reference-data/classification-types/*.json }
        - { load_endpoint: /contributor-name-types, fileglob: reference-data/contributor-name-types/*.json }
        - { load_endpoint: /contributor-types, fileglob: reference-data/contributor-types/*.json }
        - { load_endpoint: /identifier-types, fileglob: reference-data/identifier-types/*.json }
        - { load_endpoint: /instance-formats, fileglob: reference-data/instance-formats/*.json }
        - { load_endpoint: /instance-types, fileglob: reference-data/instance-types/*.json }
        - { load_endpoint: /loan-types, fileglob: reference-data/loan-types/*.json }
        - { load_endpoint: /location-units/institutions, fileglob: reference-data/location-units/institutions/*.json, dup_override: 422 }
        - { load_endpoint: /location-units/campuses, fileglob: reference-data/location-units/campuses/*.json, dup_override: 422 }
        - { load_endpoint: /location-units/libraries, fileglob: reference-data/location-units/libraries/*.json,  dup_override: 422 }
        - { load_endpoint: /locations, fileglob: reference-data/locations/*.json, dup_override: 422 }
        - { load_endpoint: /material-types, fileglob: reference-data/material-types/*.json, dup_override: 422 }
        - { load_endpoint: /platforms, fileglob: reference-data/platforms/*.json }
        - { load_endpoint: /service-points, fileglob: reference-data/service-points/*.json, dup_override: 422 }
        - { load_endpoint: /instance-storage/instances, fileglob: sample-data/instances/*.json }
        - { load_endpoint: /instance-storage/instances, fileglob: sample-data/instances/*.json }
        - { load_endpoint: /holdings-storage/holdings, fileglob: sample-data/holdingsrecords/*.json }
        - { load_endpoint: /item-storage/items, fileglob: sample-data/items/*.json }
    - folio-ansible/roles/mod-inventory-mods
    - role: folio-ansible/roles/module-sample-data
      module_name: mod-circulation-storage
      repository: "https://github.com/folio-org/mod-circulation-storage"
      files:
        - { load_endpoint: /loan-policy-storage/loan-policies, fileglob: reference-data/loan-policy-storage/loan-policies/*.json, dup_override: 500 }
        - { load_endpoint: /loan-rules-storage, fileglob: reference-data/loan-rules-storage/*.json, http_method: PUT, updated_code: 204 }
    - folio-ansible/roles/mod-circulation-sample-data
    - { role: folio-ansible/roles/mod-auth-demo-users }
